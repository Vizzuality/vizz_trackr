<% content_for :title, "Reporting Period - #{@reporting_period.display_name}" %>
<p id="notice"><%= notice %></p>

<%= link_to 'Edit', edit_reporting_period_path(@reporting_period) %> |
<%= link_to 'Back', reporting_periods_path %>
<p>
  <strong>Date:</strong>
  <%= @reporting_period.date.strftime("%B %Y") %>
</p>

<% if @reporting_period.report_parts.any? %>
  <h2>Summary</h2>
  <dl>
    <dt>Total Reporters</dt><dd><%= @total_reporters %></dd>
    <dt>Total Projects</dt><dd><%= @total_project_reports %></dd>
    <dt>Average Projects per Reporter</dt>
    <dd><%=  number_with_precision(@total_project_reports.to_f / @total_reporters, precision: 2.0) %></dd>
  </dl>
<% end %>

<%= form_with(url: @reporting_period, method: :get, local: true) do |form| %>
  <div class="form-group">
    <%= form.label :role_id %>
    <%= form.select :role_id, options_from_collection_for_select(@roles, :id, :name, selected: params[:role_id]), { prompt: true }, class: "form-control" %>
  </div>
  <div class="actions">
    <%= form.submit "Filter" %>
  </div>
<% end %>

<h2>Reports</h2>
<table class="table table-bordered">
  <thead>
    <tr>
      <th>User</th>
      <th>Team</th>
      <th>Role</th>
      <th>Project</th>
      <th>Percentage</th>
      <th>Days</th>
      <th>Cost</th>
    </tr>
  </thead>
  <tbody>
    <% table_class = 'primary' %>
    <% @reports.each do |report| %>
      <% table_class = table_class == 'primary' ? '' : 'primary' %>
      <% report.report_parts.joins(:contract).order("contracts.name ASC").each do |part| %>
        <tr class="table-<%= table_class %>">
          <td><%= report.user.try(:name)%></td>
          <td><%= report.team.try(:name)%></td>
          <td><%= report.role.try(:name)%></td>
          <td><%= part.contract.try(:full_name)%></td>
          <td><%= part.percentage %>%</td>
          <td><%= part.days %></td>
          <td><%= number_to_currency(part.cost, unit: 'â‚¬')  %></td>
        </tr>
      <% end %>
    <% end %>
  </tbody>
</table>
